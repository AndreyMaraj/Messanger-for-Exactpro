{"ast":null,"code":"var _jsxFileName = \"/Users/andrejturin/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/Messenger-for-Exactpro/client-master/src/components/Chats.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { observer } from 'mobx-react';\nimport Requests from '../Requests';\nimport Chat from './Chat';\nimport CreateChat from './CreateChat';\nimport UserAvatar from './UserAvatar';\nimport { AppBar, Avatar, IconButton, List, ListItem, ListItemAvatar, ListItemSecondaryAction, ListItemText, Toolbar, Typography } from '@material-ui/core';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport AddIcon from '@material-ui/icons/Add';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar ChatId; // Чаты пользователя\n\nconst Chats = observer(_c = _s(({\n  chatsStore,\n  messagesStore,\n  groupUsersStore,\n  profileStore,\n  onlineStatusStore\n}) => {\n  _s();\n\n  const chats = 'Chats';\n  const chat = 'Chat';\n  const addChat = 'AddChat';\n  const [item, setItem] = useState(chats); // Отображаемый элемент\n\n  const useStyles = makeStyles(theme => // стили\n  createStyles({\n    content: {\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    },\n    header: {\n      position: \"static\",\n      flexGrow: 1,\n      height: '10%'\n    },\n    headerTitle: {\n      flexGrow: 1\n    },\n    headerButton: {\n      marginLeft: theme.spacing(2),\n      color: 'white',\n      background: '#3d50b6'\n    },\n    chats: {\n      width: '100%',\n      position: 'relative',\n      overflow: 'scroll',\n      height: '90%'\n    },\n    smallAvatar: {\n      width: theme.spacing(5),\n      height: theme.spacing(5)\n    }\n  }));\n  const classes = useStyles(); // классы стилей\n  // Открытие чата\n\n  function OpenChat() {\n    groupUsersStore.usersData = []; // очитска информации о пользователях чата\n\n    groupUsersStore.chatId = ChatId;\n    var request = Requests.OpenChat(ChatId); // запрос на сервер об открытии чата\n\n    var Chat = {\n      // создание информации о чате\n      id: '',\n      type: '',\n      title: '',\n      bio: '',\n      picture: '',\n      role: '',\n      lastReadIdMessage: ''\n    };\n\n    switch (request === null || request === void 0 ? void 0 : request.status) {\n      case 200:\n        chatsStore.chatsData.map(chat => {\n          // заполнение информации о чате\n          if (chat.id === ChatId) {\n            Chat = chat;\n          }\n        });\n        return Chat;\n\n      case 401:\n        alert(\"User is not logged in.\");\n        return Chat;\n\n      default:\n        alert(\"Error.\");\n        return Chat;\n    }\n  } // Удаление чата\n\n\n  function DeleteChat(dialog) {\n    let data = {\n      // подготовка данных для отправки на сервер\n      chatId: dialog.id\n    };\n    var request = Requests.DeleteChat(data); // запрос на удаление чата\n\n    switch (request === null || request === void 0 ? void 0 : request.status) {\n      case 200:\n        break;\n\n      case 401:\n        alert(\"User is not logged in.\");\n        break;\n\n      default:\n        alert(\"Error.\");\n        break;\n    }\n  } // Получение всех пользователей мессенджера \n\n\n  function GetUsers() {\n    var request = Requests.GetAllUsers(); // запрос на получение всех пользователей мессенджера \n\n    switch (request === null || request === void 0 ? void 0 : request.status) {\n      case 200:\n        return JSON.parse(request.responseText);\n\n      case 401:\n        alert(\"User is not logged in.\");\n        return [];\n\n      default:\n        alert(\"Error.\");\n        return [];\n    }\n  }\n\n  const Search = styled('div')(({\n    theme\n  }) => ({\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: alpha(theme.palette.common.white, 0.15),\n    '&:hover': {\n      backgroundColor: alpha(theme.palette.common.white, 0.25)\n    },\n    marginRight: theme.spacing(2),\n    marginLeft: 0,\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(3),\n      width: 'auto'\n    }\n  }));\n  const SearchIconWrapper = styled('div')(({\n    theme\n  }) => ({\n    padding: theme.spacing(0, 2),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }));\n  const StyledInputBase = styled(InputBase)(({\n    theme\n  }) => ({\n    color: 'inherit',\n    '& .MuiInputBase-input': {\n      padding: theme.spacing(1, 1, 1, 0),\n      // vertical padding + font size from searchIcon\n      paddingLeft: `calc(1em + ${theme.spacing(4)})`,\n      transition: theme.transitions.create('width'),\n      width: '100%',\n      [theme.breakpoints.up('md')]: {\n        width: '20ch'\n      }\n    }\n  })); // Отображение элмента\n\n  function SetItem() {\n    switch (item) {\n      case addChat:\n        return /*#__PURE__*/_jsxDEV(CreateChat, {\n          users: GetUsers(),\n          profileStore: profileStore,\n          onlineStatusStore: onlineStatusStore,\n          Done: chatId => {\n            if (chatId === null) {\n              setItem(chats);\n            } else {\n              ChatId = chatId;\n              setItem(chat);\n            }\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 21\n        }, this);\n\n      case chat:\n        return /*#__PURE__*/_jsxDEV(Chat, {\n          messagesStore: messagesStore,\n          groupUsersStore: groupUsersStore,\n          chatInfo: OpenChat(),\n          profileStore: profileStore,\n          onlineStatusStore: onlineStatusStore,\n          Done: () => setItem(chats)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 21\n        }, this);\n\n      case chats:\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.content,\n          children: [/*#__PURE__*/_jsxDEV(AppBar, {\n            className: classes.header,\n            children: /*#__PURE__*/_jsxDEV(Toolbar, {\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                className: classes.headerTitle,\n                variant: \"h6\",\n                noWrap: true,\n                children: \"Chats\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Search, {\n                children: [/*#__PURE__*/_jsxDEV(SearchIconWrapper, {\n                  children: /*#__PURE__*/_jsxDEV(SearchIcon, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 209,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 208,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(StyledInputBase, {\n                  placeholder: \"Search\\u2026\",\n                  inputProps: {\n                    'aria-label': 'search'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 211,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n                onClick: () => setItem(addChat),\n                edge: \"start\",\n                className: classes.headerButton,\n                children: /*#__PURE__*/_jsxDEV(AddIcon, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 221,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 216,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(List, {\n            dense: true,\n            className: classes.chats,\n            children: chatsStore.chatsData.map((dialog, index) => {\n              var count = 0;\n              var newMessage = false;\n              messagesStore.messagesData.map(message => {\n                if (message.chatId === dialog.id) {\n                  if (newMessage) {\n                    count++;\n                  }\n\n                  if (message.id === dialog.lastReadIdMessage) {\n                    newMessage = true;\n                  }\n                }\n              });\n              return /*#__PURE__*/_jsxDEV(ListItem, {\n                children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                  children: dialog.type === '1' ? /*#__PURE__*/_jsxDEV(UserAvatar, {\n                    user: {\n                      name: dialog.title,\n                      picture: dialog.picture\n                    },\n                    onlineStatusStore: onlineStatusStore,\n                    size: 5\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 248,\n                    columnNumber: 49\n                  }, this) : /*#__PURE__*/_jsxDEV(Avatar, {\n                    src: dialog.picture,\n                    className: classes.smallAvatar\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 254,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 246,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                  primary: dialog.title,\n                  secondary: count === 0 ? null : count + \" Unread Message\",\n                  onClick: () => {\n                    ChatId = dialog.id;\n                    setItem(chat);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 260,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(ListItemSecondaryAction, {\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    edge: \"end\",\n                    \"aria-label\": \"delete\",\n                    onClick: () => DeleteChat(dialog),\n                    children: /*#__PURE__*/_jsxDEV(DeleteIcon, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 271,\n                      columnNumber: 49\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 266,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 265,\n                  columnNumber: 41\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 243,\n                columnNumber: 37\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this);\n\n      default:\n        return /*#__PURE__*/_jsxDEV(React.Fragment, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 21\n        }, this);\n    }\n  }\n\n  return SetItem();\n}, \"v2pbjcG4Jv6wy/DzONOesrsM9Cs=\", false, function () {\n  return [useStyles];\n}));\n_c2 = Chats;\nexport default Chats;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Chats$observer\");\n$RefreshReg$(_c2, \"Chats\");","map":{"version":3,"sources":["/Users/andrejturin/Документы/Messenger-for-Exactpro/client-master/src/components/Chats.tsx"],"names":["React","useState","observer","Requests","Chat","CreateChat","UserAvatar","AppBar","Avatar","IconButton","List","ListItem","ListItemAvatar","ListItemSecondaryAction","ListItemText","Toolbar","Typography","DeleteIcon","AddIcon","createStyles","makeStyles","ChatId","Chats","chatsStore","messagesStore","groupUsersStore","profileStore","onlineStatusStore","chats","chat","addChat","item","setItem","useStyles","theme","content","width","height","overflow","header","position","flexGrow","headerTitle","headerButton","marginLeft","spacing","color","background","smallAvatar","classes","OpenChat","usersData","chatId","request","id","type","title","bio","picture","role","lastReadIdMessage","status","chatsData","map","alert","DeleteChat","dialog","data","GetUsers","GetAllUsers","JSON","parse","responseText","Search","styled","borderRadius","shape","backgroundColor","alpha","palette","common","white","marginRight","breakpoints","up","SearchIconWrapper","padding","pointerEvents","display","alignItems","justifyContent","StyledInputBase","InputBase","paddingLeft","transition","transitions","create","SetItem","index","count","newMessage","messagesData","message","name"],"mappings":"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","sourcesContent":["import React, {useState} from 'react'\nimport { observer } from 'mobx-react'\nimport Requests from '../Requests'\nimport Chat from './Chat'\nimport CreateChat from './CreateChat'\nimport UserAvatar from './UserAvatar'\nimport ChatsStore from '../stores/ChatsStore'\nimport MessagesStore from '../stores/MessagesStore'\nimport OnlineStatusStore from '../stores/OnlineStatusStore'\nimport ProfileStore from '../stores/ProfileStore'\nimport GroupUsersStore from '../stores/GroupUsersStore'\nimport {ChatsUpdate} from '../interfaces/ChatsUpdate'\nimport { UserInfo } from '../interfaces/UserInfo'\nimport { MessagesUpdate } from '../interfaces/MessagesUpdate'\nimport { AppBar, Avatar, IconButton, List, ListItem, ListItemAvatar, ListItemSecondaryAction, ListItemText, Toolbar, Typography } from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport AddIcon  from '@material-ui/icons/Add'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Search } from '@material-ui/icons'\n\nvar ChatId: string\n\n// Чаты пользователя\nconst Chats = observer(({chatsStore, messagesStore, groupUsersStore,  profileStore, onlineStatusStore}:{chatsStore: ChatsStore, messagesStore: MessagesStore, groupUsersStore: GroupUsersStore,  profileStore: ProfileStore, onlineStatusStore: OnlineStatusStore}) => {\n\n    const chats: string = 'Chats'\n    const chat: string = 'Chat'\n    const addChat: string = 'AddChat'\n    const [item, setItem] = useState<string>(chats) // Отображаемый элемент\n    const useStyles = makeStyles((theme: Theme) => // стили\n        createStyles({\n            content: {\n                width: '100%',\n                height: '100%',\n                overflow: 'hidden'\n            },\n            header: {\n                position: \"static\",\n                flexGrow: 1,\n                height: '10%'\n            },\n            headerTitle: {\n                flexGrow: 1\n            },\n            headerButton: {\n                marginLeft: theme.spacing(2),\n                color: 'white',\n                background: '#3d50b6'\n            },\n            chats: {\n                width: '100%',\n                position: 'relative',\n                overflow: 'scroll',\n                height: '90%'\n            },\n            smallAvatar: {\n                width: theme.spacing(5),\n                height: theme.spacing(5)\n            }\n        })\n    )\n    const classes = useStyles() // классы стилей\n\n    // Открытие чата\n    function OpenChat(): ChatsUpdate {\n        groupUsersStore.usersData = [] // очитска информации о пользователях чата\n        groupUsersStore.chatId = ChatId \n        var request: {responseText: string, status: number} | null = Requests.OpenChat(ChatId) // запрос на сервер об открытии чата\n        var Chat: ChatsUpdate = { // создание информации о чате\n            id: '',\n            type: '',\n            title: '',\n            bio: '',\n            picture: '',\n            role: '',\n            lastReadIdMessage: ''\n        }\n        switch(request?.status){\n            case 200:\n                chatsStore.chatsData.map((chat: ChatsUpdate)=>{ // заполнение информации о чате\n                    if(chat.id === ChatId){\n                        Chat = chat\n                    }\n                })\n                return Chat\n            case 401:\n                alert(\"User is not logged in.\")\n                return Chat\n            default:\n                alert(\"Error.\")\n                return Chat\n        }  \n    }\n\n    // Удаление чата\n    function DeleteChat(dialog: ChatsUpdate): void {\n        let data = { // подготовка данных для отправки на сервер\n            chatId: dialog.id\n        }\n        var request: {responseText: string, status: number} | null = Requests.DeleteChat(data) // запрос на удаление чата\n        switch(request?.status){\n            case 200:\n                break\n            case 401:\n                alert(\"User is not logged in.\")\n                break\n            default:\n                alert(\"Error.\")\n                break\n        }\n    }\n\n    // Получение всех пользователей мессенджера \n    function GetUsers(): UserInfo[]{\n        var request: {responseText: string, status: number} | null = Requests.GetAllUsers() // запрос на получение всех пользователей мессенджера \n        switch(request?.status){\n          case 200:\n            return JSON.parse(request.responseText) as UserInfo[]\n          case 401:\n            alert(\"User is not logged in.\")\n            return [];\n          default:\n            alert(\"Error.\")\n            return []\n        }\n    }\n\n    const Search = styled('div')(({ theme }) => ({\n        position: 'relative',\n        borderRadius: theme.shape.borderRadius,\n        backgroundColor: alpha(theme.palette.common.white, 0.15),\n        '&:hover': {\n          backgroundColor: alpha(theme.palette.common.white, 0.25),\n        },\n        marginRight: theme.spacing(2),\n        marginLeft: 0,\n        width: '100%',\n        [theme.breakpoints.up('sm')]: {\n          marginLeft: theme.spacing(3),\n          width: 'auto',\n        },\n      }));\n      \n      const SearchIconWrapper = styled('div')(({ theme }) => ({\n        padding: theme.spacing(0, 2),\n        height: '100%',\n        position: 'absolute',\n        pointerEvents: 'none',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      }));\n      \n      const StyledInputBase = styled(InputBase)(({ theme }) => ({\n        color: 'inherit',\n        '& .MuiInputBase-input': {\n          padding: theme.spacing(1, 1, 1, 0),\n          // vertical padding + font size from searchIcon\n          paddingLeft: `calc(1em + ${theme.spacing(4)})`,\n          transition: theme.transitions.create('width'),\n          width: '100%',\n          [theme.breakpoints.up('md')]: {\n            width: '20ch',\n          },\n        },\n      }));\n\n    // Отображение элмента\n    function SetItem(): JSX.Element {\n        switch(item){\n            case addChat:\n                return(\n                    <CreateChat \n                        users={GetUsers()}\n                        profileStore={profileStore}\n                        onlineStatusStore={onlineStatusStore}\n                        Done={(chatId: string | null) => {if(chatId === null) {setItem(chats)} else{ChatId = chatId; setItem(chat)}}}\n                    />\n                )\n            case chat:\n                return(\n                    <Chat \n                        messagesStore={messagesStore} \n                        groupUsersStore={groupUsersStore} \n                        chatInfo={OpenChat()} \n                        profileStore={profileStore}\n                        onlineStatusStore={onlineStatusStore} \n                        Done={()=>setItem(chats)}\n                    />\n                )\n            case chats:\n                return(\n                    <div \n                        className={classes.content}\n                    >\n                        <AppBar\n                            className={classes.header}\n                        >\n                            <Toolbar>\n                                <Typography \n                                    className={classes.headerTitle} \n                                    variant=\"h6\" \n                                    noWrap\n                                >\n                                    Chats\n                                </Typography>\n                                <Search>\n                                    <SearchIconWrapper>\n                                        <SearchIcon />\n                                    </SearchIconWrapper>\n                                    <StyledInputBase\n                                        placeholder=\"Search…\"\n                                        inputProps={{ 'aria-label': 'search' }}\n                                    />\n                                </Search>\n                                <IconButton\n                                    onClick={()=>setItem(addChat)}\n                                    edge=\"start\"\n                                    className={classes.headerButton}\n                                >\n                                    <AddIcon/>\n                                </IconButton>\n                            </Toolbar>\n                        </AppBar>\n                        <List \n                            dense={true}\n                            className={classes.chats}\n                        >\n                            {chatsStore.chatsData.map((dialog: ChatsUpdate, index: number) =>{\n                                var count: number = 0\n                                var newMessage: boolean = false\n                                messagesStore.messagesData.map((message: MessagesUpdate) =>{\n                                    if(message.chatId === dialog.id){\n                                        if(newMessage){\n                                            count++\n                                        }\n                                        if(message.id === dialog.lastReadIdMessage){\n                                            newMessage = true\n                                        }\n                                    }\n                                })\n                                return(\n                                    <ListItem \n                                        key={index}\n                                    >\n                                        <ListItemAvatar>\n                                            {dialog.type === '1' ?\n                                                <UserAvatar \n                                                    user={{name: dialog.title, picture: dialog.picture}} \n                                                    onlineStatusStore={onlineStatusStore}\n                                                    size={5}\n                                                />\n                                            :\n                                                <Avatar\n                                                    src={dialog.picture}\n                                                    className={classes.smallAvatar}\n                                                />\n                                            }\n                                        </ListItemAvatar>\n                                        <ListItemText\n                                            primary={dialog.title}\n                                            secondary={count === 0 ? null : count + \" Unread Message\"}\n                                            onClick={()=>{ChatId = dialog.id; setItem(chat)}}\n                                        />\n                                        <ListItemSecondaryAction>\n                                            <IconButton \n                                                edge=\"end\" \n                                                aria-label=\"delete\"\n                                                onClick={()=>DeleteChat(dialog)}\n                                            >\n                                                <DeleteIcon />\n                                            </IconButton>\n                                        </ListItemSecondaryAction>\n                                    </ListItem>\n                                )\n                            })}\n                        </List>\n                    </div>\n                )\n            default:\n                return(\n                    <React.Fragment/>\n                )\n        }\n    }\n\n    return (\n        SetItem()\n    )\n})\n\nexport default Chats"]},"metadata":{},"sourceType":"module"}