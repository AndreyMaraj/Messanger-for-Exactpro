{"ast":null,"code":"var _jsxFileName = \"/Users/andrejturin/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/Messenger-for-Exactpro/client-master/src/components/Chat.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { observer } from 'mobx-react-lite';\nimport Cookie from '../Cookie';\nimport Requests from '../Requests';\nimport Profile from './Profile';\nimport UserAvatar from './UserAvatar';\nimport Messages from './Messages';\nimport ChatInformation from './ChatInformation';\nimport { AppBar, Avatar, Button, TextField, Toolbar, Typography, createStyles, makeStyles, Container, Icon, IconButton } from '@material-ui/core';\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\nimport AttachFileIcon from '@material-ui/icons/AttachFile';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar profile = ''; // Чат \n\nconst Chat = observer(_c = _s(({\n  messagesStore,\n  chatInfo,\n  groupUsersStore,\n  profileStore,\n  onlineStatusStore,\n  Done\n}) => {\n  _s();\n\n  const [message, setMessage] = useState(''); // сообщение\n\n  const [files, setFiles] = useState([]); // файлы\n\n  const [editMessage, setEditMessage] = useState(null); // измененное сообщение \n\n  const [item, setItem] = useState('Chat'); // отображаемый элемент \n\n  const useStyles = makeStyles(theme => // стили\n  createStyles({\n    content: {\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    },\n    header: {\n      position: \"static\",\n      flexGrow: 1,\n      height: '10%'\n    },\n    headerTitle: {\n      flexGrow: 1\n    },\n    headerButton: {\n      marginRight: theme.spacing(2),\n      color: 'white',\n      background: '#3d50b6'\n    },\n    chat: {\n      marginTop: theme.spacing(8),\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%',\n      alignItems: 'center'\n    },\n    paper: {\n      marginTop: theme.spacing(4),\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      height: 500\n    },\n    smallAvatar: {\n      width: theme.spacing(5),\n      height: theme.spacing(5)\n    },\n    addAttachButton: {\n      variant: \"contained\",\n      color: \"primary\"\n    },\n    sendMessageButton: {\n      variant: \"contained\",\n      color: \"primary\",\n      margin: theme.spacing(1)\n    },\n    messageInput: {}\n  }));\n  const classes = useStyles(); // классы стилей\n  // Открытие профиля\n\n  function OpenProfile() {\n    profileStore.Clear(); // очистка данных о старом профиле \n\n    var request = Requests.OpenProfile(profile); // отправка запроса на сервер об открытии профиля\n\n    switch (request === null || request === void 0 ? void 0 : request.status) {\n      case 200:\n        break;\n\n      case 401:\n        alert(\"User is not logged in.\");\n        break;\n\n      default:\n        alert(\"Error.\");\n        break;\n    }\n  } // Добавление файлов \n\n\n  function AddAttachment(event) {\n    let reader = new FileReader();\n\n    reader.onload = () => {\n      setFiles(() => {\n        var array = [];\n\n        for (var index = 0; index < files.length; index++) {\n          array[array.length] = files[index];\n        }\n\n        array[array.length] = {\n          name: event.target.files[0].name,\n          bytes: reader.result\n        };\n        console.log(array);\n        return array;\n      });\n    };\n\n    reader.onerror = error => {\n      alert('Error: ' + error);\n    };\n\n    reader.readAsDataURL(event.target.files[0]);\n  } // Удаление файла\n\n\n  function DeleteAttachment(file) {\n    setFiles(() => {\n      var array = [];\n\n      for (var index = 0; index < files.length; index++) {\n        if (file !== files[index]) {\n          array[array.length] = files[index];\n        }\n      }\n\n      return array;\n    });\n  } // Изменение файла\n\n\n  function EditMessage() {\n    if (editMessage) {\n      let data = {\n        // подготовак данных для отправки на сервер \n        chatId: chatInfo.id,\n        id: editMessage.id,\n        text: message,\n        files: files\n      };\n      var request = Requests.EditMesssage(data); // отправка запроса на сервер о редактировании сообщения\n\n      switch (request === null || request === void 0 ? void 0 : request.status) {\n        case 200:\n          // очискта данных о сообщении \n          setFiles([]);\n          setMessage(\"\");\n          setEditMessage(null);\n          break;\n\n        case 401:\n          alert(\"User is not logged in.\");\n          break;\n\n        case 403:\n          alert(\"User has insufficient rights.\");\n          break;\n\n        default:\n          alert(\"Error.\");\n          break;\n      }\n    }\n  } // Отправка сообщений\n\n\n  function SendMessage() {\n    if (message === \"\" && files === []) {} else {\n      var date = new Date();\n      let data = {\n        // подготовка данных джля отправки на сервер \n        chatId: chatInfo.id,\n        text: message,\n        time: date.getHours().toString() + \":\" + date.getMinutes().toString(),\n        date: date.getDate().toString() + \"/\" + date.getMonth().toString() + \"/\" + date.getFullYear().toString(),\n        files: files\n      };\n      var request = Requests.SendMessage(data); // отправка запроса на отправку сообщения\n\n      switch (request === null || request === void 0 ? void 0 : request.status) {\n        case 200:\n          // очистка сообщения\n          setFiles([]);\n          setMessage(\"\");\n          break;\n\n        case 401:\n          alert(\"User is not logged in.\");\n          break;\n\n        case 403:\n          alert(\"User has insufficient rights.\");\n          break;\n\n        default:\n          alert(\"Error.\");\n          break;\n      }\n    }\n  } // Запрос на файл\n\n\n  function FileRequest(src) {\n    var request = new XMLHttpRequest();\n    request.open(\"GET\", src, false);\n    request.send();\n\n    switch (request.status) {\n      case 200:\n        break;\n\n      case 401:\n        alert(\"User is not logged in.\");\n        break;\n\n      default:\n        alert(\"Error.\");\n        break;\n    }\n\n    return request.responseText;\n  } // Изменение режима на \"редактирование сообщения\"\n\n\n  function SetEditMessage(message) {\n    var cookieKeySession = Cookie.Get('key'); // Достаем из куки данные\n\n    if (cookieKeySession) {\n      setEditMessage(message);\n      setMessage(message.text);\n\n      if (message.files) {\n        setFiles(message.files.map(file => {\n          return {\n            name: file.name,\n            bytes: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)\n          };\n        }));\n      } else {\n        setFiles([]);\n      }\n    }\n  }\n\n  function SetItem() {\n    switch (item) {\n      case 'Chat':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.content,\n          children: [/*#__PURE__*/_jsxDEV(AppBar, {\n            className: classes.header,\n            children: /*#__PURE__*/_jsxDEV(Toolbar, {\n              children: [/*#__PURE__*/_jsxDEV(IconButton, {\n                onClick: () => Done(),\n                edge: \"start\",\n                className: classes.headerButton,\n                children: /*#__PURE__*/_jsxDEV(ArrowBackIosIcon, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 247,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 242,\n                columnNumber: 33\n              }, this), chatInfo.type === '1' ? /*#__PURE__*/_jsxDEV(Typography, {\n                onClick: () => {\n                  profile = chatInfo.title;\n                  setItem('Profile');\n                },\n                className: classes.headerTitle,\n                variant: \"h6\",\n                noWrap: true,\n                children: chatInfo.title\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 37\n              }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n                onClick: () => setItem('Information'),\n                className: classes.headerTitle,\n                variant: \"h6\",\n                noWrap: true,\n                children: chatInfo.title\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 37\n              }, this), chatInfo.type === '1' ? /*#__PURE__*/_jsxDEV(IconButton, {\n                onClick: () => {\n                  profile = chatInfo.title;\n                  setItem('Profile');\n                },\n                edge: \"start\",\n                className: classes.headerButton,\n                children: /*#__PURE__*/_jsxDEV(UserAvatar, {\n                  user: {\n                    name: chatInfo.title,\n                    picture: chatInfo.picture\n                  },\n                  onlineStatusStore: onlineStatusStore,\n                  size: 5\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 274,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 269,\n                columnNumber: 37\n              }, this) : /*#__PURE__*/_jsxDEV(IconButton, {\n                onClick: () => setItem('Information'),\n                edge: \"start\",\n                className: classes.headerButton,\n                children: /*#__PURE__*/_jsxDEV(Avatar, {\n                  src: chatInfo.picture,\n                  className: classes.smallAvatar\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 286,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Container, {\n            className: classes.chat,\n            children: [/*#__PURE__*/_jsxDEV(Messages, {\n              messagesStore: messagesStore,\n              chatInfo: chatInfo,\n              EditMessage: message => SetEditMessage(message)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                component: \"label\",\n                color: \"inherit\",\n                className: classes.addAttachButton,\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  onChange: event => AddAttachment(event),\n                  hidden: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 309,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(AttachFileIcon, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 314,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 303,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(TextField, {\n                label: \"Message\",\n                multiline: true,\n                rowsMax: 3,\n                value: message,\n                className: classes.messageInput,\n                onChange: event => setMessage(event.target.value)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 316,\n                columnNumber: 33\n              }, this), editMessage ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                component: \"label\",\n                className: classes.sendMessageButton,\n                onClick: () => {\n                  setMessage('');\n                  setFiles([]);\n                  setEditMessage(null);\n                },\n                children: \"Cancel Edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 325,\n                columnNumber: 37\n              }, this) : null, editMessage ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                component: \"label\",\n                className: classes.sendMessageButton,\n                endIcon: /*#__PURE__*/_jsxDEV(Icon, {\n                  children: \"send\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 340,\n                  columnNumber: 50\n                }, this),\n                onClick: () => EditMessage(),\n                children: \"Send\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 37\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                component: \"label\",\n                className: classes.sendMessageButton,\n                endIcon: /*#__PURE__*/_jsxDEV(Icon, {\n                  children: \"send\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 350,\n                  columnNumber: 50\n                }, this),\n                onClick: () => SendMessage(),\n                children: \"Send\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 346,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 29\n            }, this), files.map((file, index) => {\n              var _file$bytes, _file$bytes2, _file$bytes3, _file$bytes4, _file$bytes5, _file$bytes6, _file$bytes7, _file$bytes8, _file$bytes9, _file$bytes10;\n\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [((_file$bytes = file.bytes) === null || _file$bytes === void 0 ? void 0 : _file$bytes.slice(((_file$bytes2 = file.bytes) === null || _file$bytes2 === void 0 ? void 0 : _file$bytes2.indexOf('data')) + 5, (_file$bytes3 = file.bytes) === null || _file$bytes3 === void 0 ? void 0 : _file$bytes3.indexOf('/'))) === 'image' ? /*#__PURE__*/_jsxDEV(\"img\", {\n                  height: 50,\n                  width: 50,\n                  src: file.bytes\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 362,\n                  columnNumber: 45\n                }, this) : ((_file$bytes4 = file.bytes) === null || _file$bytes4 === void 0 ? void 0 : _file$bytes4.slice(((_file$bytes5 = file.bytes) === null || _file$bytes5 === void 0 ? void 0 : _file$bytes5.indexOf('data')) + 5, (_file$bytes6 = file.bytes) === null || _file$bytes6 === void 0 ? void 0 : _file$bytes6.indexOf('/'))) === 'video' ? /*#__PURE__*/_jsxDEV(\"video\", {\n                  height: 50,\n                  width: 50,\n                  autoPlay: true,\n                  loop: true,\n                  muted: true,\n                  controls: true,\n                  src: file.bytes\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 364,\n                  columnNumber: 45\n                }, this) : ((_file$bytes7 = file.bytes) === null || _file$bytes7 === void 0 ? void 0 : _file$bytes7.slice(((_file$bytes8 = file.bytes) === null || _file$bytes8 === void 0 ? void 0 : _file$bytes8.indexOf('data')) + 5, (_file$bytes9 = file.bytes) === null || _file$bytes9 === void 0 ? void 0 : _file$bytes9.indexOf('/'))) === 'audio' ? /*#__PURE__*/_jsxDEV(\"audio\", {\n                  controls: true,\n                  src: file.bytes\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 366,\n                  columnNumber: 45\n                }, this) : ((_file$bytes10 = file.bytes) === null || _file$bytes10 === void 0 ? void 0 : _file$bytes10.indexOf('data')) !== -1 ? /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: file.bytes,\n                  download: file.name,\n                  children: /*#__PURE__*/_jsxDEV(\"button\", {\n                    children: file.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 368,\n                    columnNumber: 87\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 368,\n                  columnNumber: 45\n                }, this) : null, /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => DeleteAttachment(file),\n                  children: \"Delete\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 370,\n                  columnNumber: 41\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 360,\n                columnNumber: 37\n              }, this);\n            })]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 21\n        }, this);\n\n      case 'Information':\n        return /*#__PURE__*/_jsxDEV(ChatInformation, {\n          chatInfo: chatInfo,\n          groupUsersStore: groupUsersStore,\n          profileStore: profileStore,\n          onlineStatusStore: onlineStatusStore,\n          Done: () => setItem('Chat')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 21\n        }, this);\n\n      case 'Profile':\n        OpenProfile();\n        return /*#__PURE__*/_jsxDEV(Profile, {\n          profileStore: profileStore,\n          onlineStatusStore: onlineStatusStore,\n          Change: false,\n          Done: () => setItem('Chat')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 21\n        }, this);\n\n      default:\n        return /*#__PURE__*/_jsxDEV(React.Fragment, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 21\n        }, this);\n    }\n  }\n\n  return SetItem();\n}, \"mDE7W4gmvVoF1hMQYVEULl1zoag=\", false, function () {\n  return [useStyles];\n}));\n_c2 = Chat;\nexport default Chat;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Chat$observer\");\n$RefreshReg$(_c2, \"Chat\");","map":{"version":3,"sources":["/Users/andrejturin/Документы/Messenger-for-Exactpro/client-master/src/components/Chat.tsx"],"names":["React","useState","observer","Cookie","Requests","Profile","UserAvatar","Messages","ChatInformation","AppBar","Avatar","Button","TextField","Toolbar","Typography","createStyles","makeStyles","Container","Icon","IconButton","ArrowBackIosIcon","AttachFileIcon","profile","Chat","messagesStore","chatInfo","groupUsersStore","profileStore","onlineStatusStore","Done","message","setMessage","files","setFiles","editMessage","setEditMessage","item","setItem","useStyles","theme","content","width","height","overflow","header","position","flexGrow","headerTitle","headerButton","marginRight","spacing","color","background","chat","marginTop","display","flexDirection","alignItems","paper","smallAvatar","addAttachButton","variant","sendMessageButton","margin","messageInput","classes","OpenProfile","Clear","request","status","alert","AddAttachment","event","reader","FileReader","onload","array","index","length","name","target","bytes","result","console","log","onerror","error","readAsDataURL","DeleteAttachment","file","EditMessage","data","chatId","id","text","EditMesssage","SendMessage","date","Date","time","getHours","toString","getMinutes","getDate","getMonth","getFullYear","FileRequest","src","XMLHttpRequest","open","send","responseText","SetEditMessage","cookieKeySession","Get","map","SetItem","type","title","picture","value","slice","indexOf"],"mappings":"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","sourcesContent":["import React, {ChangeEvent, useState} from 'react'\nimport {observer} from 'mobx-react-lite'\nimport Cookie from '../Cookie'\nimport Requests from '../Requests'\nimport Profile from './Profile'\nimport UserAvatar from './UserAvatar'\nimport Messages from './Messages'\nimport ChatInformation from './ChatInformation'\nimport MessagesStore from '../stores/MessagesStore'\nimport ProfileStore from '../stores/ProfileStore'\nimport OnlineStatusStore from '../stores/OnlineStatusStore'\nimport GroupUsersStore from '../stores/GroupUsersStore'\nimport { ChatsUpdate } from \"../interfaces/ChatsUpdate\"\nimport { MessagesUpdate } from '../interfaces/MessagesUpdate'\nimport { AppBar, Avatar, Button, TextField, Toolbar, Typography, createStyles, makeStyles, Theme, Container, Icon, IconButton } from '@material-ui/core'\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos'\nimport AttachFileIcon from '@material-ui/icons/AttachFile'\n\nvar profile: string = ''\n\n// Чат \nconst Chat = observer(({messagesStore, chatInfo, groupUsersStore, profileStore, onlineStatusStore, Done}:{messagesStore: MessagesStore, chatInfo: ChatsUpdate, groupUsersStore: GroupUsersStore, profileStore: ProfileStore, onlineStatusStore: OnlineStatusStore, Done: ()=> void}) => {\n    \n    const [message, setMessage] = useState<string>('') // сообщение\n    const [files, setFiles] = useState<{name: string, bytes: string}[]>([]) // файлы\n    const [editMessage, setEditMessage] = useState<MessagesUpdate | null>(null) // измененное сообщение \n    const [item, setItem] = useState<string>('Chat') // отображаемый элемент \n    const useStyles = makeStyles((theme: Theme) => // стили\n        createStyles({\n            content: {\n                width: '100%',\n                height: '100%',\n                overflow: 'hidden'\n            },\n            header: {\n                position: \"static\",\n                flexGrow: 1,\n                height: '10%'\n            },\n            headerTitle: {\n                flexGrow: 1\n            },\n            headerButton: {\n                marginRight: theme.spacing(2),\n                color: 'white',\n                background: '#3d50b6'\n            },\n            chat: {\n                marginTop: theme.spacing(8),\n                display: 'flex',\n                flexDirection: 'column',\n                height: '100%',\n                alignItems: 'center'\n            },\n            paper: {\n                marginTop: theme.spacing(4),\n                display: 'flex',\n                flexDirection: 'column',\n                alignItems: 'center',\n                height: 500\n            },\n            smallAvatar: {\n                width: theme.spacing(5),\n                height: theme.spacing(5)\n            },\n            addAttachButton: {\n                variant: \"contained\",\n                color: \"primary\"\n            },\n            sendMessageButton: {\n                variant: \"contained\",\n                color: \"primary\",\n                margin: theme.spacing(1)\n            },\n            messageInput: {\n\n            }\n        })\n    )\n    const classes = useStyles() // классы стилей\n\n    // Открытие профиля\n    function OpenProfile(): void {\n        profileStore.Clear() // очистка данных о старом профиле \n        var request: {responseText: string, status: number} | null = Requests.OpenProfile(profile) // отправка запроса на сервер об открытии профиля\n        switch(request?.status){ \n            case 200:\n                break\n            case 401:\n                alert(\"User is not logged in.\")\n                break\n            default:\n                alert(\"Error.\")\n                break\n        }     \n    }\n\n    // Добавление файлов \n    function AddAttachment(event: any): void {\n        let reader: FileReader = new FileReader()\n        reader.onload = () => {\n            setFiles(()=>{\n                var array: {name: string, bytes: string}[] = []\n                for(var index: number = 0; index < files.length; index++){\n                    array[array.length] = files[index]\n                }\n                array[array.length] = {\n                    name: event.target.files[0].name,\n                    bytes: reader.result as string\n                }\n                console.log(array)\n                return array\n            })\n        }\n        reader.onerror = (error) => {\n            alert('Error: ' + error)\n        }\n        reader.readAsDataURL(event.target.files[0])\n    }\n\n    // Удаление файла\n    function DeleteAttachment(file: {name: string, bytes: string}): void{\n        setFiles(()=>{\n            var array: {name: string, bytes: string}[] = []\n            for(var index: number = 0; index < files.length; index++){\n                if (file !== files[index]){\n                    array[array.length] = files[index]\n                }\n            }\n            return array\n        })\n    }\n\n    // Изменение файла\n    function EditMessage(): void{\n        if (editMessage) {\n            let data: {chatId: string, id: string, text: string, files: {name: string, bytes: string}[]} = { // подготовак данных для отправки на сервер \n                chatId: chatInfo.id,\n                id: editMessage.id,\n                text: message,\n                files: files\n            }\n            var request: {responseText: string, status: number} | null = Requests.EditMesssage(data) // отправка запроса на сервер о редактировании сообщения\n            switch(request?.status){\n                case 200:\n                    // очискта данных о сообщении \n                    setFiles([]) \n                    setMessage(\"\")\n                    setEditMessage(null)\n                    break\n                case 401:\n                    alert(\"User is not logged in.\")\n                    break\n                case 403:\n                    alert(\"User has insufficient rights.\")\n                    break\n                default:\n                    alert(\"Error.\")\n                    break\n            }\n        }\n    }\n\n    // Отправка сообщений\n    function SendMessage(): void{\n        if (message === \"\" && files === []) {}\n        else{\n            var date: Date = new Date()\n            let data: {chatId: string, text: string, time: string, date: string, files: {name: string, bytes: string}[]} = { // подготовка данных джля отправки на сервер \n                chatId: chatInfo.id,\n                text: message,\n                time: date.getHours().toString() + \":\" + date.getMinutes().toString(),\n                date: date.getDate().toString() + \"/\" + date.getMonth().toString() + \"/\" + date.getFullYear().toString(),\n                files: files\n            }\n            var request: {responseText: string, status: number} | null = Requests.SendMessage(data) // отправка запроса на отправку сообщения\n            switch(request?.status){\n                case 200:\n                    // очистка сообщения\n                    setFiles([])\n                    setMessage(\"\")\n                    break\n                case 401:\n                    alert(\"User is not logged in.\")\n                    break\n                case 403:\n                    alert(\"User has insufficient rights.\")\n                    break\n                default:\n                    alert(\"Error.\")\n                    break\n            }\n        }\n    }\n\n    // Запрос на файл\n    function FileRequest(src: string): string{\n        var request: XMLHttpRequest = new XMLHttpRequest()\n        request.open(\"GET\", src, false)\n        request.send()\n        switch(request.status){\n            case 200:\n                break\n            case 401:\n                alert(\"User is not logged in.\")\n                break\n            default:\n                alert(\"Error.\")\n                break\n        }\n        return request.responseText\n    }\n\n    // Изменение режима на \"редактирование сообщения\"\n    function SetEditMessage(message: MessagesUpdate): void{\n        var cookieKeySession: string | null = Cookie.Get('key') // Достаем из куки данные\n        if(cookieKeySession){\n            setEditMessage(message)\n            setMessage(message.text)\n            if(message.files){\n                setFiles(message.files.map((file: {name: string, type: string, id: string})=>{\n                    return {name: file.name, bytes: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)}\n                }))\n            }\n            else{\n                setFiles([])\n            }\n        }\n    }\n\n    function SetItem(): JSX.Element {\n        switch(item){\n            case 'Chat':\n                return(\n                    <div\n                    className={classes.content}\n                    >\n                        <AppBar \n                            className={classes.header}\n                        >\n                            <Toolbar>\n                                <IconButton\n                                    onClick={()=>Done()}\n                                    edge=\"start\"\n                                    className={classes.headerButton}\n                                >\n                                    <ArrowBackIosIcon />\n                                </IconButton>\n                                {chatInfo.type === '1' ?\n                                    <Typography \n                                        onClick={()=>{profile = chatInfo.title; setItem('Profile')}} \n                                        className={classes.headerTitle}\n                                        variant=\"h6\" \n                                        noWrap\n                                    >\n                                        {chatInfo.title}\n                                    </Typography>\n                                :\n                                    <Typography \n                                        onClick={()=>setItem('Information')} \n                                        className={classes.headerTitle} \n                                        variant=\"h6\" \n                                        noWrap\n                                    >\n                                        {chatInfo.title}\n                                    </Typography>\n                                }\n                                {chatInfo.type === '1' ?\n                                    <IconButton\n                                        onClick={()=>{profile = chatInfo.title; setItem('Profile')}}\n                                        edge=\"start\"\n                                        className={classes.headerButton}\n                                    >\n                                        <UserAvatar \n                                            user={{name: chatInfo.title, picture: chatInfo.picture}} \n                                            onlineStatusStore={onlineStatusStore}\n                                            size={5}\n                                        />\n                                    </IconButton>\n                                :\n                                    <IconButton\n                                        onClick={()=>setItem('Information')}\n                                        edge=\"start\"\n                                        className={classes.headerButton}\n                                    >\n                                        <Avatar \n                                            src={chatInfo.picture}\n                                            className={classes.smallAvatar}\n                                        />\n                                    </IconButton>\n                                }\n                            </Toolbar>\n                        </AppBar>\n                        <Container\n                            className={classes.chat}\n                        >\n                            <Messages \n                                messagesStore={messagesStore} \n                                chatInfo={chatInfo}\n                                EditMessage={(message: MessagesUpdate)=>SetEditMessage(message)}\n                            />\n                            <div>\n                                <Button\n                                    variant=\"contained\"\n                                    component=\"label\"\n                                    color=\"inherit\"\n                                    className={classes.addAttachButton}\n                                    >\n                                    <input\n                                        type=\"file\"\n                                        onChange={(event: ChangeEvent<HTMLInputElement>)=>AddAttachment(event)}\n                                        hidden\n                                    />\n                                    <AttachFileIcon />\n                                </Button>\n                                <TextField\n                                    label=\"Message\"\n                                    multiline\n                                    rowsMax={3}\n                                    value={message}\n                                    className={classes.messageInput}\n                                    onChange={(event: ChangeEvent<HTMLInputElement>)=>setMessage(event.target.value)}\n                                />\n                                {editMessage ?\n                                    <Button\n                                        variant=\"contained\"\n                                        component=\"label\"\n                                        className={classes.sendMessageButton}\n                                        onClick={()=>{setMessage(''); setFiles([]); setEditMessage(null)}}\n                                    >\n                                        Cancel Edit\n                                    </Button>\n                                : null\n                                }\n                                {editMessage ? \n                                    <Button\n                                        variant=\"contained\"\n                                        component=\"label\"\n                                        className={classes.sendMessageButton}\n                                        endIcon={<Icon>send</Icon>}\n                                        onClick={()=>EditMessage()}\n                                    >\n                                        Send\n                                    </Button>\n                                :\n                                    <Button\n                                        variant=\"contained\"\n                                        component=\"label\"\n                                        className={classes.sendMessageButton}\n                                        endIcon={<Icon>send</Icon>}\n                                        onClick={()=>SendMessage()}\n                                    >\n                                        Send\n                                    </Button>\n                                }\n                                \n                            </div>\n                            {files.map((file, index: number)=>{\n                                return(\n                                    <div key={index}>\n                                        {file.bytes?.slice(file.bytes?.indexOf('data') + 5, file.bytes?.indexOf('/')) === 'image' ?\n                                            <img height={50} width={50} src={file.bytes}/>\n                                        : file.bytes?.slice(file.bytes?.indexOf('data') + 5, file.bytes?.indexOf('/')) === 'video' ?\n                                            <video height={50} width={50} autoPlay loop muted controls src={file.bytes}></video>\n                                        : file.bytes?.slice(file.bytes?.indexOf('data') + 5, file.bytes?.indexOf('/')) === 'audio' ?\n                                            <audio controls src={file.bytes} />\n                                        : file.bytes?.indexOf('data') !== -1 ?\n                                            <a href={file.bytes} download={file.name}><button>{file.name}</button></a>\n                                        : null}\n                                        <button onClick={()=>DeleteAttachment(file)}>Delete</button>\n                                    </div>\n                                )\n                            })}\n                        </Container>\n                    </div>\n                )\n            case 'Information':\n                return(\n                    <ChatInformation \n                        chatInfo={chatInfo} \n                        groupUsersStore={groupUsersStore} \n                        profileStore={profileStore} \n                        onlineStatusStore={onlineStatusStore} \n                        Done={()=>setItem('Chat')}\n                    />\n                )\n            case 'Profile':\n                OpenProfile();\n                return(\n                    <Profile \n                        profileStore={profileStore} \n                        onlineStatusStore={onlineStatusStore}\n                        Change={false} \n                        Done={()=>setItem('Chat')}\n                    />\n                )\n            default:\n                return(\n                    <React.Fragment/>\n                )\n        }\n    }\n\n    return (\n        SetItem()\n    )\n})\n\nexport default Chat\n"]},"metadata":{},"sourceType":"module"}