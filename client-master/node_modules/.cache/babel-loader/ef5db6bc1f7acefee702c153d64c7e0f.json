{"ast":null,"code":"var _jsxFileName = \"/Users/andrejturin/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/Messenger-for-Exactpro/client-master/src/components/Messages.tsx\",\n    _s = $RefreshSig$();\n\nimport { observer } from 'mobx-react-lite';\nimport Cookie from '../Cookie';\nimport Requests from '../Requests';\nimport { Avatar, createStyles, IconButton, List, ListItem, ListItemAvatar, ListItemSecondaryAction, ListItemText, makeStyles } from '@material-ui/core';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport EditIcon from '@material-ui/icons/Edit';\nimport DoneIcon from '@material-ui/icons/Done';\nimport DoneAllIcon from '@material-ui/icons/DoneAll'; // сообщения чата\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Messages = observer(_c = _s(({\n  messagesStore,\n  chatInfo,\n  EditMessage\n}) => {\n  _s();\n\n  const useStyles = makeStyles(theme => // стили\n  createStyles({\n    messages: {\n      overflow: 'auto',\n      width: 600,\n      height: 350\n    },\n    myMessage: {\n      background: 'gray'\n    },\n    anyMessage: {},\n    smallAvatar: {\n      width: theme.spacing(5),\n      height: theme.spacing(5)\n    },\n    root: {\n      width: '100%',\n      backgroundColor: theme.palette.background.paper\n    }\n  }));\n  const classes = useStyles(); // классы стилей\n  // прочтение сообщения\n\n  function ReadMessage(message) {\n    let data = {\n      // подготовка данных для отправки на сервер \n      chatId: chatInfo.id,\n      id: message.id\n    };\n    var request = Requests.ReadMessage(data); // отправка запроса на сервер о прочтении сообщения\n\n    switch (request === null || request === void 0 ? void 0 : request.status) {\n      case 200:\n        break;\n\n      case 400:\n        alert(\"\");\n        break;\n\n      default:\n        break;\n    }\n  } // Удаление сообщения\n\n\n  function DeleteMessage(messageId) {\n    let data = {\n      // подготовка данных  для отправки на сервер\n      chatId: chatInfo.id,\n      id: messageId\n    };\n    var request = Requests.DeleteMessage(data); // отправка запроса на сервер об удалении сообщения\n\n    switch (request === null || request === void 0 ? void 0 : request.status) {\n      case 200:\n        break;\n\n      case 400:\n        alert(\"\");\n        break;\n\n      default:\n        break;\n    }\n  } // проверка строки на URL\n\n\n  function isURL(str) {\n    try {\n      var url = new URL(str);\n      return url.toString().indexOf('.') !== -1;\n    } catch {\n      return false;\n    }\n  } // запрос на файл\n\n\n  function FileRequest(src) {\n    var request = new XMLHttpRequest();\n    request.open(\"GET\", src, false);\n    request.send();\n\n    switch (request.status) {\n      case 200:\n        break;\n\n      case 400:\n        alert(\"Данные некорректны!\");\n        break;\n\n      default:\n        break;\n    }\n\n    return request.responseText;\n  }\n\n  return /*#__PURE__*/_jsxDEV(List, {\n    className: classes.root,\n    children: messagesStore.messagesData.map((message, index) => {\n      if (chatInfo.id === message.chatId) {\n        var _message$files;\n\n        // если сообщение из этого чата\n        var messageWithSources = [];\n        var sources = [];\n        var sourcesAttachments = [];\n        var messageTextCopy = message.text; // обрезаем строку на составляющие (строка, ссылка)\n\n        messageTextCopy.replace(/(https?:\\/\\/[^\\s]+)/g, url => {\n          sources[sources.length] = url;\n          messageWithSources[messageWithSources.length] = messageTextCopy.substring(0, messageTextCopy.indexOf(url));\n          messageWithSources[messageWithSources.length] = /*#__PURE__*/_jsxDEV(\"a\", {\n            href: url,\n            target: \"_blank\",\n            children: url\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 73\n          }, this);\n\n          if (isURL(url)) {\n            sourcesAttachments[sourcesAttachments.length] = url;\n          }\n\n          messageTextCopy = messageTextCopy.substring(messageTextCopy.indexOf(url) + url.length);\n          return '';\n        });\n        messageWithSources[messageWithSources.length] = messageTextCopy;\n\n        if (!message.read && !message.mine) {\n          ReadMessage(message); // прочтение сообщения\n        }\n\n        return /*#__PURE__*/_jsxDEV(ListItem, {\n          alignItems: \"flex-start\",\n          className: message.mine ? classes.myMessage : classes.anyMessage,\n          children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n            children: /*#__PURE__*/_jsxDEV(Avatar, {\n              src: message.senderPicture,\n              className: classes.smallAvatar\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n            primary: messageWithSources,\n            secondary: message.time + message.edited ? /*#__PURE__*/_jsxDEV(EditIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 77\n            }, this) : \"\" + message.mine && message.read ? /*#__PURE__*/_jsxDEV(DoneIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 128\n            }, this) : /*#__PURE__*/_jsxDEV(DoneAllIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 143\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 29\n          }, this), sourcesAttachments.map((source, i) => {\n            if (source.substring(source.lastIndexOf('.')) === '.png' || source.substring(source.lastIndexOf('.')) === '.jpg' || source.substring(source.lastIndexOf('.')) === '.jpeg' || source.substring(source.lastIndexOf('.')) === '.svg') {\n              return /*#__PURE__*/_jsxDEV(\"img\", {\n                src: source\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 44\n              }, this);\n            }\n\n            if (source.substring(source.lastIndexOf('.')) === '.mp3') {\n              return /*#__PURE__*/_jsxDEV(\"audio\", {\n                controls: true,\n                src: source\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 148,\n                columnNumber: 44\n              }, this);\n            }\n\n            if (source.substring(source.lastIndexOf('.')) === '.mp4') {\n              return /*#__PURE__*/_jsxDEV(\"video\", {\n                autoPlay: true,\n                loop: true,\n                muted: true,\n                controls: true,\n                src: source\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 151,\n                columnNumber: 44\n              }, this);\n            }\n          }), (_message$files = message.files) === null || _message$files === void 0 ? void 0 : _message$files.map((file, i) => {\n            var cookieKeySession = Cookie.Get('key'); // Достаем из куки данные\n\n            if (cookieKeySession) {\n              var _file$type, _file$type2, _file$type3, _file$type4, _file$type5, _file$type6;\n\n              return ((_file$type = file.type) === null || _file$type === void 0 ? void 0 : _file$type.slice(0, (_file$type2 = file.type) === null || _file$type2 === void 0 ? void 0 : _file$type2.indexOf('/'))) === 'image' ? /*#__PURE__*/_jsxDEV(\"img\", {\n                src: \"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 45\n              }, this) : ((_file$type3 = file.type) === null || _file$type3 === void 0 ? void 0 : _file$type3.slice(0, (_file$type4 = file.type) === null || _file$type4 === void 0 ? void 0 : _file$type4.indexOf('/'))) === 'video' ? /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"video\", {\n                  autoPlay: true,\n                  loop: true,\n                  muted: true,\n                  controls: true,\n                  src: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)\n                }, i, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 162,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id),\n                  download: file.name,\n                  children: /*#__PURE__*/_jsxDEV(\"button\", {\n                    children: \"Download\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 163,\n                    columnNumber: 199\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 163,\n                  columnNumber: 49\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 161,\n                columnNumber: 45\n              }, this) : ((_file$type5 = file.type) === null || _file$type5 === void 0 ? void 0 : _file$type5.slice(0, (_file$type6 = file.type) === null || _file$type6 === void 0 ? void 0 : _file$type6.indexOf('/'))) === 'audio' ? /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n                  controls: true,\n                  src: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)\n                }, i, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 167,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id),\n                  download: file.name,\n                  children: /*#__PURE__*/_jsxDEV(\"button\", {\n                    children: \"Download\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 168,\n                    columnNumber: 199\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 168,\n                  columnNumber: 49\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 45\n              }, this) : /*#__PURE__*/_jsxDEV(\"a\", {\n                href: FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id),\n                download: file.name,\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  children: file.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 171,\n                  columnNumber: 203\n                }, this)\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 45\n              }, this);\n            }\n          }), /*#__PURE__*/_jsxDEV(ListItemSecondaryAction, {\n            children: [message.mine ? /*#__PURE__*/_jsxDEV(IconButton, {\n              edge: \"end\",\n              \"aria-label\": \"delete\",\n              children: /*#__PURE__*/_jsxDEV(EditIcon, {\n                onClick: () => EditMessage(message)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 33\n            }, this) : null, message.mine || chatInfo.type === '2' && (chatInfo.role === 'owner' || chatInfo.role === 'admin' && message.senderRole === 'none') ? /*#__PURE__*/_jsxDEV(IconButton, {\n              edge: \"end\",\n              \"aria-label\": \"delete\",\n              children: /*#__PURE__*/_jsxDEV(DeleteIcon, {\n                onClick: () => DeleteMessage(message.id)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 185,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 37\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 29\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 25\n        }, this);\n      }\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 9\n  }, this);\n}, \"8g5FPXexvSEOsxdmU7HicukHGqY=\", false, function () {\n  return [useStyles];\n}));\n_c2 = Messages;\nexport default Messages;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Messages$observer\");\n$RefreshReg$(_c2, \"Messages\");","map":{"version":3,"sources":["/Users/andrejturin/Документы/Messenger-for-Exactpro/client-master/src/components/Messages.tsx"],"names":["observer","Cookie","Requests","Avatar","createStyles","IconButton","List","ListItem","ListItemAvatar","ListItemSecondaryAction","ListItemText","makeStyles","DeleteIcon","EditIcon","DoneIcon","DoneAllIcon","Messages","messagesStore","chatInfo","EditMessage","useStyles","theme","messages","overflow","width","height","myMessage","background","anyMessage","smallAvatar","spacing","root","backgroundColor","palette","paper","classes","ReadMessage","message","data","chatId","id","request","status","alert","DeleteMessage","messageId","isURL","str","url","URL","toString","indexOf","FileRequest","src","XMLHttpRequest","open","send","responseText","messagesData","map","index","messageWithSources","sources","sourcesAttachments","messageTextCopy","text","replace","length","substring","read","mine","senderPicture","time","edited","source","i","lastIndexOf","files","file","cookieKeySession","Get","type","slice","name","role","senderRole"],"mappings":"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","sourcesContent":["import {observer} from 'mobx-react-lite'\nimport Cookie from '../Cookie'\nimport Requests from '../Requests'\nimport MessagesStore from '../stores/MessagesStore'\nimport {MessagesUpdate} from \"../interfaces/MessagesUpdate\"\nimport { Avatar, Button, createStyles, IconButton, List, ListItem, ListItemAvatar, ListItemSecondaryAction, ListItemText, makeStyles, Theme } from '@material-ui/core'\nimport { ChatsUpdate } from '../interfaces/ChatsUpdate'\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport EditIcon from '@material-ui/icons/Edit';\nimport DoneIcon from '@material-ui/icons/Done';\nimport DoneAllIcon from '@material-ui/icons/DoneAll';\n\n// сообщения чата\nconst Messages = observer(({messagesStore, chatInfo, EditMessage}:{messagesStore: MessagesStore, chatInfo: ChatsUpdate, EditMessage: (message: MessagesUpdate)=> void})=>{\n\n    const useStyles = makeStyles((theme: Theme) => // стили\n        createStyles({\n            messages: {\n                overflow: 'auto',\n                width: 600,\n                height: 350\n            },\n            myMessage: {\n                background: 'gray'\n            },\n            anyMessage: {\n\n            },\n            smallAvatar: {\n                width: theme.spacing(5),\n                height: theme.spacing(5)\n            },\n            root: {\n                width: '100%',\n                backgroundColor: theme.palette.background.paper,\n              },\n        })\n    )\n    const classes = useStyles() // классы стилей\n\n    // прочтение сообщения\n    function ReadMessage(message: MessagesUpdate): void{\n        let data: {chatId: string, id: string} = { // подготовка данных для отправки на сервер \n            chatId: chatInfo.id, \n            id: message.id\n        }\n        var request: {responseText: string, status: number} | null = Requests.ReadMessage(data) // отправка запроса на сервер о прочтении сообщения\n        switch(request?.status){\n            case 200:\n                break\n            case 400:\n                alert(\"\")\n                break\n            default:\n                break\n        }\n    }\n\n    // Удаление сообщения\n    function DeleteMessage(messageId: string): void{\n        let data: {chatId: string, id: string} = { // подготовка данных  для отправки на сервер\n            chatId: chatInfo.id, \n            id: messageId\n        }\n        var request: {responseText: string, status: number} | null = Requests.DeleteMessage(data) // отправка запроса на сервер об удалении сообщения\n        switch(request?.status){\n            case 200:\n                break\n            case 400:\n                alert(\"\")\n                break\n            default:\n                break\n        }\n    }\n\n    // проверка строки на URL\n    function isURL(str: string): boolean{\n        try {\n            var url = new URL(str)\n            return url.toString().indexOf('.') !== -1\n        } \n        catch {\n            return false\n        }\n    }\n\n    // запрос на файл\n    function FileRequest(src: string): string{\n        var request: XMLHttpRequest = new XMLHttpRequest()\n        request.open(\"GET\", src, false)\n        request.send()\n        switch(request.status){\n            case 200:\n                break\n            case 400:\n                alert(\"Данные некорректны!\")\n                break\n            default:\n                break\n        }\n        return request.responseText\n    }\n\n    return (\n        <List className={classes.root} >\n            {messagesStore.messagesData.map((message: MessagesUpdate, index: number) => {\n                if (chatInfo.id === message.chatId){ // если сообщение из этого чата\n                    var messageWithSources: any[] = []\n                    var sources: string[] = []\n                    var sourcesAttachments: string[] = []\n                    var messageTextCopy = message.text\n                    // обрезаем строку на составляющие (строка, ссылка)\n                    messageTextCopy.replace(/(https?:\\/\\/[^\\s]+)/g, (url) => {\n                        sources[sources.length] = url\n                        messageWithSources[messageWithSources.length] = messageTextCopy.substring(0, messageTextCopy.indexOf(url))\n                        messageWithSources[messageWithSources.length] = <a href={url} target=\"_blank\">{url}</a>\n                        if (isURL(url)){\n                            sourcesAttachments[sourcesAttachments.length] = url\n                        }\n                        messageTextCopy = messageTextCopy.substring(messageTextCopy.indexOf(url) + url.length)\n                        return ''\n                    })\n                    messageWithSources[messageWithSources.length] = messageTextCopy\n                    if(!message.read && !message.mine){\n                        ReadMessage(message) // прочтение сообщения\n                    }\n                    return(\n                        <ListItem alignItems=\"flex-start\" \n                            key={index}\n                            className={message.mine ? classes.myMessage : classes.anyMessage}\n                        >\n                            <ListItemAvatar>\n                                <Avatar \n                                    src={message.senderPicture} \n                                    className={classes.smallAvatar}\n                                />\n                            </ListItemAvatar>\n                            <ListItemText\n                                primary={messageWithSources}\n                                secondary={message.time + message.edited ?  <EditIcon /> : \"\" + message.mine && message.read ? <DoneIcon /> : <DoneAllIcon/>}\n                            />\n                            {sourcesAttachments.map((source: string, i: number)=>{\n                                if(source.substring(source.lastIndexOf('.')) === '.png' || source.substring(source.lastIndexOf('.')) === '.jpg' || source.substring(source.lastIndexOf('.')) === '.jpeg' || source.substring(source.lastIndexOf('.')) === '.svg'){\n                                    return <img key={i} src={source}/>\n                                }\n                                if(source.substring(source.lastIndexOf('.')) === '.mp3'){\n                                    return <audio key={i} controls src={source}/>\n                                }\n                                if(source.substring(source.lastIndexOf('.')) === '.mp4'){\n                                    return <video key={i} autoPlay loop muted controls src={source}/>\n                                }\n                            })}\n                            {message.files?.map((file: {name: string, type: string, id: string}, i: number)=>{\n                                var cookieKeySession: string | null = Cookie.Get('key') // Достаем из куки данные\n                                if(cookieKeySession){\n                                    return(\n                                        file.type?.slice(0, file.type?.indexOf('/')) === 'image' ?\n                                            <img key={i} src={\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id}/>\n                                        : file.type?.slice(0, file.type?.indexOf('/')) === 'video' ?\n                                            <div>\n                                                <video key={i} autoPlay loop muted controls src={FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)}></video>\n                                                <a href={FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)} download={file.name}><button>Download</button></a>\n                                            </div>\n                                        : file.type?.slice(0, file.type?.indexOf('/')) === 'audio' ?\n                                            <div>\n                                                <audio key={i} controls src={FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)} />\n                                                <a href={FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)} download={file.name}><button>Download</button></a>\n                                            </div>\n                                        :\n                                            <a key={i} href={FileRequest(\"http://127.0.0.1:8081/get-file?key=\" + cookieKeySession + \"&chatId=\" + message.chatId + \"&id=\" + file.id)} download={file.name}><button>{file.name}</button></a>\n                                    )\n                                }\n                            })\n                            }\n                            <ListItemSecondaryAction>\n                            {message.mine ?\n                                <IconButton edge=\"end\" aria-label=\"delete\">\n                                    <EditIcon onClick={()=>EditMessage(message)}/>\n                                </IconButton>\n                            : null\n                            }\n                                {message.mine || (chatInfo.type === '2' && (chatInfo.role === 'owner' || (chatInfo.role === 'admin' && message.senderRole === 'none'))) ?\n                                    <IconButton edge=\"end\" aria-label=\"delete\">\n                                        <DeleteIcon onClick={()=>DeleteMessage(message.id)}/>\n                                    </IconButton>\n                                : null\n                                }\n                                \n                            </ListItemSecondaryAction>\n                        </ListItem>\n                    )\n                }\n            })}\n        </List>\n    )\n})\n\nexport default Messages"]},"metadata":{},"sourceType":"module"}